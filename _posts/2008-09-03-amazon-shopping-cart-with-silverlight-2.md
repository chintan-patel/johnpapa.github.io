---
layout: post
title: Amazon Shopping Cart with Silverlight 2
date: 2008-09-03 23:25
author: John
comments: true
categories: [Silverlight]
---
<p>&nbsp;</p>
<p>I&rsquo;ve been working on the basis for a shopping cart example using the <a href="http://docs.amazonwebservices.com/AWSEcommerceService/2005-10-05/index.html">Amazon.com RESTful API</a> and Silverlight 2 for <a href="http://www.amazon.com/exec/obidos/ASIN/0596523092/johnpanet-20">my book</a>. Their API is pretty extensive and <a href="http://docs.amazonwebservices.com/AWSEcommerceService/2005-10-05/index.html">the documentation</a> is top notch. Its amazing how much more effective developers can be with good documentation. The application allows the user to search for items, create a shopping cart and add/remove the items in a Silverlight UI. Its pretty cool and obviously can be extended quite a bit. Here&rsquo;s a glimpse of the app where I added <a href="http://www.amazon.com/Programming-Entity-Framework-Julia-Lerman/dp/059652028X%3FSubscriptionId%3D1XC2ANGP2DYD42WPHJ82%26tag%3Dws%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D059652028X">Julie Lerman&rsquo;s book</a> and my <a href="http://www.amazon.com/exec/obidos/ASIN/0596523092/johnpanet-20">Data Services with Silverlight 2</a> book to the cart, while shopping for some other items.</p>
<p><a href="http://images.johnpapa.net/wp-content/uploads/files/media/image/WindowsLiveWriter/AmazonShoppingCartwithSilverlight2_13821/image_2.png"><img title="image" style="border-right: 0px; border-top: 0px; margin: 5px; border-left: 0px; border-bottom: 0px" height="550" alt="image" width="506" border="0" src="http://images.johnpapa.net/wp-content/uploads/files/media/image/WindowsLiveWriter/AmazonShoppingCartwithSilverlight2_13821/image_thumb.png" /></a></p>
<p>I ran into a problem along the way where I could not get the shopping cart code passed and URL encoded properly. The code is called an HMAC code and Amazon uses it as a key value for the cart identification along with a Cart Id. The HMAC may contain the + sign. Aha, you say &hellip; there&rsquo;s the rub. The + sign must be encoded to %2B. Even Amazon&rsquo;s documentation reinforces this. However simply encoding the + to %2B is not enough. (2b or not 2b? &hellip; lol) When I did this and watched the request fly off to Amazon (watching it through Fiddler2) the url contained a + again! Amazon returned a response alright, but it contained an error about the invalid HMAC.</p>
<p>The solution was that I had to double encode it! I used the HttpUtility.UrlEncode method to do the job and since I was in Silverlight there were limited options since I did not have the entire CLR at my disposal. So I had to encode the + to a %2B and then again to a %25B. Then I watched it fly off to Amazon and all was well.</p>
<p>So the lesson in the story is that in Silverlight if you need to pass a +&nbsp; in a parameter of a Uri then you should double UrlEncode it. Amazon returns a URLEncodedeHMAC in the response (after you create a cart) so I grabbed that and encoded it once. The other option is to grab the un-encoded HMAC and double encode it.</p>
<p>Oh, and no, I am not going to ship my codes and IDs with the final solution in the book. I&nbsp; don&rsquo;t want everyone buying stuff from Amazon on my tab!</p>
<div class="wlWriterHeaderFooter" style="padding-right: 4px; padding-left: 4px; padding-bottom: 4px; margin: 0px; padding-top: 4px; text-align: left"><a href="http://www.dotnetkicks.com/kick/?url=/data-services-with-silverlight-2/amazon-shopping-cart-with-silverlight-2/"><img alt="DotNetKicks Image" border="0" src="http://www.dotnetkicks.com/Services/Images/KickItImageGenerator.ashx?url=/data-services-with-silverlight-2/amazon-shopping-cart-with-silverlight-2/&amp;bgcolor=0080C0&amp;fgcolor=FFFFFF&amp;border=000000&amp;cbgcolor=D4E1ED&amp;cfgcolor=000000" /></a></div>
<div class="wlWriterHeaderFooter" style="padding-right: 4px; padding-left: 4px; padding-bottom: 4px; margin: 0px; padding-top: 4px; text-align: left"><script type="text/javascript"><!-- var dzone_url = '/data-services-with-silverlight-2/amazon-shopping-cart-with-silverlight-2/'; var dzone_title = 'Amazon Shopping Cart with Silverlight 2'; var dzone_blurb = 'Amazon Shopping Cart with Silverlight 2'; var dzone_style = '1'; --></script><script language="javascript" src="http://widgets.dzone.com/widgets/zoneit.js"></script></div>

